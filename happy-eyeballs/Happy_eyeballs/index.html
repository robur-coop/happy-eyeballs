<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Happy_eyeballs (happy-eyeballs.Happy_eyeballs)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">happy-eyeballs</a> &#x00BB; Happy_eyeballs</nav><header class="odoc-preamble"><h1>Module <code><span>Happy_eyeballs</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>The internal state of happy eyeballs.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-id"><a href="#type-id" class="anchor"></a><code><span><span class="keyword">type</span> id</span></code></div><div class="spec-doc"><p>The type for a connection identifier.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-action"><a href="#type-action" class="anchor"></a><code><span><span class="keyword">type</span> action</span><span> = </span></code><ol><li id="type-action.Resolve_a" class="def variant constructor anchored"><a href="#type-action.Resolve_a" class="anchor"></a><code><span>| </span><span><span class="constructor">Resolve_a</span> <span class="keyword">of</span> <span><span>[ `host ]</span> <span class="xref-unresolved">Domain_name</span>.t</span></span></code></li><li id="type-action.Resolve_aaaa" class="def variant constructor anchored"><a href="#type-action.Resolve_aaaa" class="anchor"></a><code><span>| </span><span><span class="constructor">Resolve_aaaa</span> <span class="keyword">of</span> <span><span>[ `host ]</span> <span class="xref-unresolved">Domain_name</span>.t</span></span></code></li><li id="type-action.Connect" class="def variant constructor anchored"><a href="#type-action.Connect" class="anchor"></a><code><span>| </span><span><span class="constructor">Connect</span> <span class="keyword">of</span> <span><span>[ `host ]</span> <span class="xref-unresolved">Domain_name</span>.t</span> * <a href="#type-id">id</a> * int * <span class="xref-unresolved">Ipaddr</span>.t * int</span></code></li><li id="type-action.Connect_failed" class="def variant constructor anchored"><a href="#type-action.Connect_failed" class="anchor"></a><code><span>| </span><span><span class="constructor">Connect_failed</span> <span class="keyword">of</span> <span><span>[ `host ]</span> <span class="xref-unresolved">Domain_name</span>.t</span> * <a href="#type-id">id</a> * string</span></code></li></ol></div><div class="spec-doc"><p>The variant of actions to be performed by the effectful layer.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_action"><a href="#val-pp_action" class="anchor"></a><code><span><span class="keyword">val</span> pp_action : <span><a href="#type-action">action</a> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div><div class="spec-doc"><p><code>pp_action ppf a</code> pretty-prints the action <code>a</code> on <code>ppf</code>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-event"><a href="#type-event" class="anchor"></a><code><span><span class="keyword">type</span> event</span><span> = </span></code><ol><li id="type-event.Resolved_a" class="def variant constructor anchored"><a href="#type-event.Resolved_a" class="anchor"></a><code><span>| </span><span><span class="constructor">Resolved_a</span> <span class="keyword">of</span> <span><span>[ `host ]</span> <span class="xref-unresolved">Domain_name</span>.t</span> * <span class="xref-unresolved">Ipaddr</span>.V4.Set.t</span></code></li><li id="type-event.Resolved_aaaa" class="def variant constructor anchored"><a href="#type-event.Resolved_aaaa" class="anchor"></a><code><span>| </span><span><span class="constructor">Resolved_aaaa</span> <span class="keyword">of</span> <span><span>[ `host ]</span> <span class="xref-unresolved">Domain_name</span>.t</span> * <span class="xref-unresolved">Ipaddr</span>.V6.Set.t</span></code></li><li id="type-event.Resolved_a_failed" class="def variant constructor anchored"><a href="#type-event.Resolved_a_failed" class="anchor"></a><code><span>| </span><span><span class="constructor">Resolved_a_failed</span> <span class="keyword">of</span> <span><span>[ `host ]</span> <span class="xref-unresolved">Domain_name</span>.t</span> * string</span></code></li><li id="type-event.Resolved_aaaa_failed" class="def variant constructor anchored"><a href="#type-event.Resolved_aaaa_failed" class="anchor"></a><code><span>| </span><span><span class="constructor">Resolved_aaaa_failed</span> <span class="keyword">of</span> <span><span>[ `host ]</span> <span class="xref-unresolved">Domain_name</span>.t</span> * string</span></code></li><li id="type-event.Connection_failed" class="def variant constructor anchored"><a href="#type-event.Connection_failed" class="anchor"></a><code><span>| </span><span><span class="constructor">Connection_failed</span> <span class="keyword">of</span> <span><span>[ `host ]</span> <span class="xref-unresolved">Domain_name</span>.t</span> * <a href="#type-id">id</a> * <span class="xref-unresolved">Ipaddr</span>.t * int * string</span></code></li><li id="type-event.Connected" class="def variant constructor anchored"><a href="#type-event.Connected" class="anchor"></a><code><span>| </span><span><span class="constructor">Connected</span> <span class="keyword">of</span> <span><span>[ `host ]</span> <span class="xref-unresolved">Domain_name</span>.t</span> * <a href="#type-id">id</a> * <span class="xref-unresolved">Ipaddr</span>.t * int</span></code></li></ol></div><div class="spec-doc"><p>The variant of events.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_event"><a href="#val-pp_event" class="anchor"></a><code><span><span class="keyword">val</span> pp_event : <span><a href="#type-event">event</a> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div><div class="spec-doc"><p><code>pp_event ppf e</code> pretty-prints event <code>e</code> on <code>ppf</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : 
  <span><span class="optlabel">?aaaa_timeout</span>:int64 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?connect_delay</span>:int64 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?connect_timeout</span>:int64 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?resolve_timeout</span>:int64 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?resolve_retries</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span>int64 <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>create ~aaaa_timeout ~connect_delay ~connect_timeout ~resolve_timeout ~resolve_retries ts</code> creates the internal state, initialized with the timestamp <code>ts</code> (an arbitrary number that must be monotonically increasing). The timeouts are specified in nanoseconds: the default of <code>aaaa_timeout</code> is <code>Duration.of_ms 50</code>, <code>connect_delay</code> is <code>Duration.of_ms 50</code>, <code>connect_timeout</code> is <code>Duration.of_sec 10</code>, and <code>resolve_timeout</code> is <code>Duration.of_sec 1</code>. The <code>resolve_retries</code> defaults to 3.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-timer"><a href="#val-timer" class="anchor"></a><code><span><span class="keyword">val</span> timer : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int64 <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a> * <span>[ `Suspend <span>| `Act</span> ]</span> * <span><a href="#type-action">action</a> list</span></span></code></div><div class="spec-doc"><p><code>timer t ts</code> is a timer function that results in an updated <code>t</code> and either <code>`Suspend</code> signalling that there are no pending connection establishments and the timer thread can suspend, or <code>`Act</code> that the timer should be called again after sleeping. In addition, a list of actions that need to be performed (connection establishment to be retried, connection failures to be reported, ...) is provided. If the timer thread has been suspended it should be signalled to resume after calling <code>connect</code> or <code>connect_ip</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-connect"><a href="#val-connect" class="anchor"></a><code><span><span class="keyword">val</span> connect : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>int64 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">id</span>:<a href="#type-id">id</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>[ `host ]</span> <span class="xref-unresolved">Domain_name</span>.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>int list</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a> * <span><a href="#type-action">action</a> list</span></span></code></div><div class="spec-doc"><p><code>connect t ts ~id host ports</code> attempts a connection to <code>host</code>, where the <code>ports</code> are attempted in sequence. It results in an updated <code>t</code> and a list of actions to be performed.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Failure</code> <p>if <code>ports</code> is the empty list.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-connect_ip"><a href="#val-connect_ip" class="anchor"></a><code><span><span class="keyword">val</span> connect_ip : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>int64 <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">id</span>:<a href="#type-id">id</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="xref-unresolved">Ipaddr</span>.t * int)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a> * <span><a href="#type-action">action</a> list</span></span></code></div><div class="spec-doc"><p><code>connect_ip t ts ~id addresses</code> attempts a connection to <code>addresses</code>. By default, the list will be tried in sequence. The ports will be tried in sequence. The result is an updated <code>t</code> and a list of actions to be performed.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Failure</code> <p>if <code>addresses</code> is the empty list.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-event"><a href="#val-event" class="anchor"></a><code><span><span class="keyword">val</span> event : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int64 <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-event">event</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a> * <span><a href="#type-action">action</a> list</span></span></code></div><div class="spec-doc"><p><code>event t ts ev</code> results in an updated <code>t</code> and a list of actions to be performed.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Failure</code> <p>if <code>ev</code> contains an empty set of IP addresses.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-resolve_timeout"><a href="#val-resolve_timeout" class="anchor"></a><code><span><span class="keyword">val</span> resolve_timeout : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int64</span></code></div><div class="spec-doc"><p><code>resolve_timeout t</code> is the timeout for the resolver in nanoseconds.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Waiter_map"><a href="#module-Waiter_map" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Waiter_map/index.html">Waiter_map</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>A map for waiters and internal id.</p></div></div></div></body></html>
